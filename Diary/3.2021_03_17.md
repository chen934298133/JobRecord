## &#127800; 2021-03-17

上班第三天。

大哥给了你个门禁显示系统的需求，需要把视图内部的数据投放到室内大屏幕上。
需求大概是这样的，原有的系统门禁系统是让官方人员装好的，老大需要投在门边的大屏上的实时数据上加上抓拍的头像，其他部分不需要改动。官方人员认为这是额外的需求，需要额外收费。最后老大让官方给出这部分的代码(当时你并不知道是部分代码)，你们自己修改。
算是第一个具体的需求吧，激动又紧张。
接到大哥的需求后，大哥并没有给你任何知道，应该是希望你自己先折腾一下，然后看看你的大概水平，能够做到哪里。
看了大概的需求后，大哥和你说了最简单的是用jdbc写完就可以了。

而你的想法是，既然页面只需要改动一点，数据也还是那些数据，那直接按照原有系统的源码更改即可。于是你整个上午把大哥给的代码一行一行看了一遍。
快看完的时候愈发觉得不对劲，因为并没有找到与展示页面相关的代码，根本无法更改。而此时，大家已经去午休了，不能去叫醒大哥。于是你拿出昨天晚上学习的`JDBC`代码`Demo`，对照着`Demo`按照这次的需求新增了一个`Controller`。

等到大哥来的时候你向大哥询问，这个代码应该是不全的吧？
大哥直接和你说，“你过来吧，你写一个Demo给你看看，俗话说言传身教，这样效果好一点。”
“这个代码呢是人家官方给的一小部分，怎么可能把所有的代码都给你呢。但是人家丢了个PGSQL的视图给你们，既然有数据，你们就自己写一个JDBC自己读取你们需要的数据就行咯。你写的JDBC未必是对的。”

又听到了未必。
果然

- 首先**PGSQL的驱动就和MySQL不一样**
- 其次Exception**不能直接throw掉**，这与你平时练习不同，平时练习throw出去，看控制台就可以，真实项目里，你throw出去给谁呢？**必须使用try_catch方法。**
- 最后释放资源的时候不能直接释放啊，**需要在finally中释放**。

大哥写的Demo是读取其中一段数据的，于是你按照需求添加了其他的5个sql。

此时的你还不懂如何把数据给前端，问了大哥，大哥让你把所有的键值对都放在一个map接口里返回就好了，你似懂非懂。

你知道前端需要的就是6个数据名与值。
于是你尝试把6个sql查询整合成一个sql，但是你发现，这六个sql是6个无关的查询，完全没办法整合。
于是你想把六个查询的结果使用sql语句整合起来，但是你找遍blog发现，唯一找到类似的就是说这是无法实现的，但是你以为只是自己没有找到，于是你一直找一直找，直到时间来到5:20，大哥过来问你完成的怎么样，你和他说了你的想法。

大哥又让你过去，看了你的代码后，他说六个完全不相干的经过复杂运作的结果用是不能放在sql一起一次性导出来的！而且有三个是需要查询今日的数据，让我自己加个时间戳与视图里的时间对比下。

然后大哥大概把整合写一遍给你看看，大哥拿来新建了一个map和一个list，先将其中独立的键值对，如：人名——陈琛
放在一个map里，然后把其他4个类似的键值对都放进去。然后给你测试了一下，果然5个键值对放在了一个result_map里，一次传了出来。
最后有个组合的数据，组合里也有6个相关联的键值对，大哥给了你一个思路，给你建立了一个泛型为`Map`的`ArrayList`，让你互相套用，最后放在最终的`result_map`里就可以了。

你把代码拿回去，从头到尾自己注释了一下，理解后已经5:55了，大哥已经开始收拾东西，大哥和你说，写的差不多了就带回去写完吧，这几天市长要来。这个系统一定要赶紧做完。你理清思绪后，已经大概知道该怎么做了，于是你笑着说好的，应该再添十几行代码就可以了。

回到家后，吃完饭休息了一会已经8点了，你打开IDEA,看了眼代码，自己又加了一个`hashMap`，把六个键值对一对一对放在这个`hashMap`里，然后把`hashMap``add`在大哥给你建的`ArrayList`里，最后把`List``put`到最终的`result_map`中。

关于时间戳，你上网搜了下如何获取，然后在try/catch外定义了这段代码。
```java
// 获取当日零点时间戳
Long nowTime =  System.currentTimeMillis();
long todayStartTime = (nowTime - ((nowTime + TimeZone.getDefault().getRawOffset()) % (24 * 60 * 60 * 1000L)))/1000;
```
但是如何在`sql`语句中使用`java`定义的变量呢？你又去网上搜索，按照网上给的格式试了试`'"+todayStartTime+"'"`，发现没有爆红，你想测试一下但是没有数据，只能明天早点去公司看看。
   
```sql
sql = "select count(xxx) as xxx from xxx.xxx where xxx <>1 and xxx > '"+todayStartTime+"'";
```
  
由于没有数据测试整体功能，你自己按照框架大概创建了一组假数据测试输出了下`result_map`，已经得到了所有前端需要读取的信息，于是你整理了一下代码，加上了应有的注释后，开始了今天的算法与SQL基本功练习。
